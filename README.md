# Image Archiver Tool (图片自动归档工具)

这是一个用于自动整理和归档图片的 Python 工具。它可以扫描指定的多个文件夹，将图片按照“最后修改日期”自动移动到对应的日期子文件夹中，并自动清理过期的历史归档。

## ✨ 主要功能

1.  **多路径支持**：支持配置多个源文件夹，脚本会按顺序依次处理。
2.  **自动归档**：将散乱的图片移动到 `YYYYMMDD` 格式的日期文件夹中。
3.  **智能过滤**：
    *   **保护当天数据**：不处理当天的图片，避免干扰正在拍摄或传输的任务。
    *   **时间窗口**：仅处理最近 **3天** 内的历史图片（可配置），提高扫描效率。
4.  **自动清理**：自动删除超过保留期限（默认 45 天）的旧日期文件夹。
5.  **详细日志**：所有操作和错误都会记录在脚本同级目录下的 `archive_log.txt` 中。

## ⚙️ 配置说明

打开 `image_archiver_v2.py` 文件，在顶部的配置区域进行修改：

### 1. 配置需要处理的文件夹
修改 `SOURCE_DIRECTORIES` 列表，填入你需要整理的文件夹绝对路径。
```python
SOURCE_DIRECTORIES = [
    r"C:\Photos\Camera01",
    r"D:\Backup\Images",
    # 可以添加更多...
]
```

### 2. 修改归档文件类型
默认仅处理 `.jpg` 文件。如果需要处理其他类型，修改 `ARCHIVE_FILE_TYPES`：
```python
ARCHIVE_FILE_TYPES = ('.jpg', '.png', '.mp4')
```

### 3. 修改保留时间
默认保留 45 天的数据。修改 `RETENTION_DAYS`：
```python
RETENTION_DAYS = 45
```

## 🚀 如何运行

### 方法一：直接运行 (测试用)
在脚本目录下打开终端 (CMD 或 PowerShell)，运行：
```bash
python image_archiver_v2.py
```
### 方法二：使用 BAT 脚本 (方便双击运行)
直接运行 `Deploy_Portable.bat` 文件
将脚本自动添加到 Windows 任务计划程序中，设置为每天自动运行。
**目录结构要求：**
确保解压后的文件夹中包含以下核心文件：
*   `Deploy_Portable.bat` (一键部署脚本)
*   `image_archiver_v2.py` (归档主程序)
*   `python_env/` 文件夹 (内置 Python 运行环境)

**部署步骤：**

1.  **以管理员身份运行脚本**：
    *   找到 `Deploy_Portable.bat` 文件。
    *   鼠标右键点击该文件，选择 **“以管理员身份运行” (Run as Administrator)**。
    *   *注意：注册 Windows 任务计划通常需要管理员权限，直接双击运行可能会导致“任务注册失败”。*

2.  **自动配置**：
    *   脚本会自动识别当前路径下的 `python_env` 环境。
    *   自动创建名为 `Camera_Image_Archiver_Portable` 的 Windows 计划任务。
    *   **默认策略**：每天凌晨 **02:00** 自动唤醒并执行归档流程。

3.  **验证运行**：
    *   脚本执行完毕后会提示是否立即测试。输入 `Y` 并回车，可立即触发一次后台运行。
    *   运行结果和详细记录请查看同目录下的日志文件：`archive_log.txt`。

**如何卸载/停止：**
如需取消自动归档，请打开“任务计划程序”，找到名为 `Camera_Image_Archiver_Portable` 的任务并删除即可。


## 📝 日志与排错

*   日志文件位置：`archive_log.txt` (位于脚本同级目录)
*   **常见问题**：
    *   **文件没移动？** 请检查文件的“修改时间”是否在最近 3 天内，且不是今天。
    *   **报错被占用？** 日志会显示 `[错误] 移动文件失败...`，通常是因为文件正在被其他软件打开。

---
*Last Updated: 2026-02-27*